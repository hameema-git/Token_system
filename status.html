<!DOCTYPE html>
<html>
<head>
    <title>Token Status</title>
    <style>
        body { font-family: Arial; background: #f7f7f7; padding: 30px; text-align: center; }
        .card {
            width: 320px; margin: auto; padding: 25px;
            background: white; border-radius: 12px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .number { font-size: 42px; font-weight: bold; }
        .label { margin-top: 20px; font-size: 20px; }
    </style>

    <script type="module">
        import { apiGet } from "./js/api.v2.js?v=3";

        async function loadStatus() {
            try {
                // 1Ô∏è‚É£ Get general queue status
                const status = await apiGet({ action: "getstatus" });
                document.getElementById("current").innerText = status.currentToken;

                // 2Ô∏è‚É£ Retrieve customer phone
                const phone = localStorage.getItem("myPhone");
                if (!phone) return;

                // 3Ô∏è‚É£ Get customer‚Äôs token
                const my = await apiGet({
                    action: "getmytoken",
                    phone: phone
                });

                if (my.token) {
                    document.getElementById("yourtoken").innerText = my.token;
                    document.getElementById("ahead").innerText = my.ahead;
                } else {
                    document.getElementById("yourtoken").innerText = "-";
                    document.getElementById("ahead").innerText = "-";
                }

            } catch (err) {
                console.error(err);
                document.getElementById("current").innerText = "Error";
            }
        }

        setInterval(loadStatus, 3000);
        window.onload = loadStatus;
    </script>
</head>

<body>

<h1>üç´ Token Status</h1>

<div class="card">
    <div class="label">Current Token Being Served:</div>
    <div class="number" id="current">0</div>

    <div class="label">Your Token:</div>
    <div class="number" id="yourtoken">-</div>

    <div class="label">People Ahead of You:</div>
    <div class="number" id="ahead">-</div>
</div>

</body>
</html>
